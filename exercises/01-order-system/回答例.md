# 回答例: マジックナンバーの使用

## リファクタリング後のコード

```typescript
/**
 * 注文ステータスを表すenum
 */
enum OrderStatus {
  PENDING = 0,
  PROCESSING = 1,
  COMPLETED = 2,
  CANCELLED = 3,
  REFUNDING = 4,
}

/**
 * 割引に関する定数
 */
const DISCOUNT_CONFIG = {
  HIGH_AMOUNT_THRESHOLD: 10000,
  HIGH_AMOUNT_RATE: 0.1,
  MEDIUM_AMOUNT_THRESHOLD: 5000,
  MEDIUM_AMOUNT_RATE: 0.05,
} as const;

/**
 * 注文金額の検証に関する定数
 */
const ORDER_AMOUNT_LIMITS = {
  MIN: 100,
  MAX: 1000000,
} as const;

interface Order {
  id: string;
  status: OrderStatus;
  totalAmount: number;
  userId: string;
  createdAt: Date;
}

class OrderService {
  processOrder(order: Order): string {
    switch (order.status) {
      case OrderStatus.PENDING:
        return "注文は保留中です";
      case OrderStatus.PROCESSING:
        return "注文を処理中です";
      case OrderStatus.COMPLETED:
        return "注文が完了しました";
      case OrderStatus.CANCELLED:
        return "注文がキャンセルされました";
      case OrderStatus.REFUNDING:
        return "返金処理中です";
      default:
        return "不明なステータスです";
    }
  }
  
  calculateDiscount(order: Order): number {
    if (order.totalAmount > DISCOUNT_CONFIG.HIGH_AMOUNT_THRESHOLD) {
      return order.totalAmount * DISCOUNT_CONFIG.HIGH_AMOUNT_RATE;
    }
    
    if (order.totalAmount > DISCOUNT_CONFIG.MEDIUM_AMOUNT_THRESHOLD) {
      return order.totalAmount * DISCOUNT_CONFIG.MEDIUM_AMOUNT_RATE;
    }
    
    return 0;
  }
  
  validateOrder(order: Order): boolean {
    if (order.totalAmount < ORDER_AMOUNT_LIMITS.MIN) {
      return false;
    }
    
    if (order.totalAmount > ORDER_AMOUNT_LIMITS.MAX) {
      return false;
    }
    
    return true;
  }
}
```

## 改善のポイント

### 1. enumの使用

- `OrderStatus`を`enum`で定義することで、ステータスの意味が明確になった
- TypeScriptの型チェックにより、不正な値の代入を防げる
- IDEの補完機能が使えるようになる

### 2. 定数オブジェクトの使用

- `DISCOUNT_CONFIG`で割引に関する設定を一箇所にまとめた
- `as const`を使用することで、値の変更を防ぎ、型推論を厳密にした
- 設定の変更が必要な場合、一箇所を修正するだけで済む

### 3. 命名の工夫

- `HIGH_AMOUNT_THRESHOLD`など、数値の意味を明確に表現
- 関連する定数をグループ化（DISCOUNT_CONFIG, ORDER_AMOUNT_LIMITS）

### 4. 保守性の向上

- 定数を変更する際の影響範囲が明確
- 新しいステータスの追加が容易
- テストコードでも同じ定数を使用できる

## さらなる改善案

### 設定ファイルへの分離

```typescript
// config/orderConfig.ts
export const DISCOUNT_CONFIG = {
  HIGH_AMOUNT_THRESHOLD: 10000,
  HIGH_AMOUNT_RATE: 0.1,
  MEDIUM_AMOUNT_THRESHOLD: 5000,
  MEDIUM_AMOUNT_RATE: 0.05,
} as const;

export const ORDER_AMOUNT_LIMITS = {
  MIN: 100,
  MAX: 1000000,
} as const;

// enums/OrderStatus.ts
export enum OrderStatus {
  PENDING = 0,
  PROCESSING = 1,
  COMPLETED = 2,
  CANCELLED = 3,
  REFUNDING = 4,
}
```

### メッセージの定数化

```typescript
const ORDER_STATUS_MESSAGES: Record<OrderStatus, string> = {
  [OrderStatus.PENDING]: "注文は保留中です",
  [OrderStatus.PROCESSING]: "注文を処理中です",
  [OrderStatus.COMPLETED]: "注文が完了しました",
  [OrderStatus.CANCELLED]: "注文がキャンセルされました",
  [OrderStatus.REFUNDING]: "返金処理中です",
};

class OrderService {
  processOrder(order: Order): string {
    return ORDER_STATUS_MESSAGES[order.status] ?? "不明なステータスです";
  }
}
```

## 学んだこと

1. **マジックナンバーは可読性と保守性を低下させる**
2. **定数やenumを使用することで、コードの意図が明確になる**
3. **関連する定数はグループ化して管理する**
4. **TypeScriptの型システムを活用することで、安全性が向上する**
