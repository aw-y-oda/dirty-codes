# ヒント: 密結合

## 問題点

このコードには以下の問題があります：

1. **具体的な実装への依存**
   - `NotificationService`が`EmailService`と`SMSService`の具体的な実装に依存
   - `OrderService`が`NotificationService`の具体的な実装に依存
   - コンストラクタ内で直接インスタンスを生成している

2. **テストの困難さ**
   - モックやスタブに置き換えることが困難
   - 単体テストが書きにくい

3. **拡張性の低さ**
   - 新しい通知方法（例: Push通知）を追加する際、既存コードを大きく変更する必要がある
   - 通知方法の組み合わせを増やすと、if文が増殖する

4. **再利用性の低さ**
   - 他のプロジェクトで同じロジックを使いたい場合、依存関係ごと持っていく必要がある

## 改善のポイント

### 1. インターフェースの導入

```typescript
interface NotificationChannel {
  send(to: string, message: string): void;
}
```

抽象に依存することで、具体的な実装を簡単に差し替え可能に。

### 2. 依存性注入（DI: Dependency Injection）

```typescript
class NotificationService {
  constructor(private channels: NotificationChannel[]) {}
}
```

コンストラクタで依存を外部から注入することで、疎結合に。

### 3. ストラテジーパターン

通知方法を戦略として扱い、実行時に切り替え可能に。

### 4. ファクトリーパターン

オブジェクトの生成を専用のファクトリークラスに委譲。

## 考えてみよう

- どのような抽象化（インターフェース）を定義すべきですか？
- 依存性注入をどのように実装しますか？
- 新しい通知方法を追加する際、どこを変更すればよいですか？
- ユーザー情報の取得も疎結合にできますか？
